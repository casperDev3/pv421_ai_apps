"""
====================================================================
   –ü–ï–†–¶–ï–ü–¢–†–û–ù: –ù–ê–ô–ü–†–û–°–¢–Ü–®–ê –ù–ï–ô–†–û–ù–ù–ê –ú–ï–†–ï–ñ–ê
   –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ–π–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
====================================================================

–ó–∞–¥–∞—á–∞: –ù–∞–≤—á–∏—Ç–∏ –ø–µ—Ä—Ü–µ–ø—Ç—Ä–æ–Ω –≤—ñ–¥—Ä—ñ–∑–Ω—è—Ç–∏ –¥–≤–∞ –∫–ª–∞—Å–∏ –æ–±'—î–∫—Ç—ñ–≤ (—è–±–ª—É–∫–∞ üçé —Ç–∞ –≥—Ä—É—à—ñ üçê)
–∑–∞ –¥–≤–æ–º–∞ –æ–∑–Ω–∞–∫–∞–º–∏:
 - –í–∞–≥–∞ (–≥)
 - –Ü–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å –∫–æ–ª—å–æ—Ä—É (0 - —Å–≤—ñ—Ç–ª–∏–π, 1 - –Ω–∞—Å–∏—á–µ–Ω–∏–π)

–ü–µ—Ä—Ü–µ–ø—Ç—Ä–æ–Ω –º–∞—î:
 - 2 –≤—Ö–æ–¥–∏ (–≤–∞–≥–∞, –∫–æ–ª—ñ—Ä)
 - 1 –≤–∏—Ö—ñ–¥ (0 = –≥—Ä—É—à–∞, 1 = —è–±–ª—É–∫–æ)
====================================================================
"""

import numpy as np
import matplotlib.pyplot as plt
from matplotlib.colors import ListedColormap
from sklearn.metrics import confusion_matrix, classification_report
import seaborn as sns

# ---------------------------
# 1. –ì–µ–Ω–µ—Ä—É—î–º–æ —Å–∏–Ω—Ç–µ—Ç–∏—á–Ω—ñ –¥–∞–Ω—ñ
# ---------------------------
np.random.seed(42)

# –ö–ª–∞—Å 0: –≥—Ä—É—à—ñ (–ª–µ–≥–∫—ñ, —Å–≤—ñ—Ç–ª—ñ)
pear_weight = np.random.normal(150, 10, 50)
pear_color = np.random.normal(0.3, 0.1, 50)

# –ö–ª–∞—Å 1: —è–±–ª—É–∫–∞ (–≤–∞–∂—á—ñ, —Ç–µ–º–Ω—ñ—à—ñ)
apple_weight = np.random.normal(180, 10, 50)
apple_color = np.random.normal(0.7, 0.1, 50)

# –û–±'—î–¥–Ω—É—î–º–æ –¥–∞–Ω—ñ
X = np.vstack((
    np.column_stack((pear_weight, pear_color)),
    np.column_stack((apple_weight, apple_color))
))
y = np.array([0] * 50 + [1] * 50)

# –ù–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è –æ–∑–Ω–∞–∫
X = (X - X.mean(axis=0)) / X.std(axis=0)


# ---------------------------
# 2. –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –≤–∏—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
# ---------------------------
# plt.figure(figsize=(7,5))
# plt.scatter(X[y==0][:,0], X[y==0][:,1], color='green', label='–ì—Ä—É—à—ñ üçê')
# plt.scatter(X[y==1][:,0], X[y==1][:,1], color='red', label='–Ø–±–ª—É–∫–∞ üçé')
# plt.title("–í—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ: —è–±–ª—É–∫–∞ vs –≥—Ä—É—à—ñ")
# plt.xlabel("–í–∞–≥–∞ (–Ω–æ—Ä–º.)")
# plt.ylabel("–ö–æ–ª—ñ—Ä (–Ω–æ—Ä–º.)")
# plt.legend()
# plt.show()

def evaluate_model(model, X, y):
    y_pred = model.predict(X)

    # –ú–∞—Ç—Ä–∏—Ü—è –ø–ª—É—Ç–∞–Ω–∏–Ω–∏
    cm = confusion_matrix(y, y_pred)

    plt.figure(figsize=(5, 4))
    sns.heatmap(cm, annot=True, fmt='d', cmap='Blues',
                xticklabels=['–ì—Ä—É—à–∞', '–Ø–±–ª—É–∫–æ'],
                yticklabels=['–ì—Ä—É—à–∞', '–Ø–±–ª—É–∫–æ'])
    plt.title("–ú–∞—Ç—Ä–∏—Ü—è –ø–ª—É—Ç–∞–Ω–∏–Ω–∏")
    plt.xlabel("–ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏–π –∫–ª–∞—Å")
    plt.ylabel("–°–ø—Ä–∞–≤–∂–Ω—ñ–π –∫–ª–∞—Å")
    plt.show()

    # –ó–≤—ñ—Ç –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
    print("–ó–≤—ñ—Ç –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:")
    print(classification_report(y, y_pred, target_names=['–ì—Ä—É—à–∞', '–Ø–±–ª—É–∫–æ']))


# ---------------------------
# 3. –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø–µ—Ä—Ü–µ–ø—Ç—Ä–æ–Ω–∞ –∑ –Ω—É–ª—è
# ---------------------------
class Perceptron:
    def __init__(self, n_inputs, learning_rate=0.1, epochs=50):
        self.lr = learning_rate
        self.epochs = epochs
        self.weights = np.zeros(n_inputs)
        self.bias = 0.0

    def step(self, x):
        """–ü–æ—Ä–æ–≥–æ–≤–∞ —Ñ—É–Ω–∫—Ü—ñ—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó"""
        return np.where(x >= 0, 1, 0)

    def predict(self, X):
        """–ü–µ—Ä–µ–¥–±–∞—á–µ–Ω–Ω—è –∫–ª–∞—Å—É"""
        linear_output = np.dot(X, self.weights) + self.bias
        return self.step(linear_output)

    def fit(self, X, y):
        """–ù–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ"""
        history = []
        for epoch in range(self.epochs):
            errors = 0
            for xi, target in zip(X, y):
                # evaluate_model(self, X, y)
                y_pred = self.predict(xi)
                update = self.lr * (target - y_pred)
                self.weights += update * xi
                self.bias += update
                errors += int(update != 0.0)
            history.append(errors)
            print(f"–ï–ø–æ—Ö–∞ {epoch + 1}/{self.epochs} ‚Äî –ø–æ–º–∏–ª–∫–∏: {errors}")
        return history


# ---------------------------
# 4. –ù–∞–≤—á–∞–Ω–Ω—è –º–æ–¥–µ–ª—ñ
# ---------------------------
model = Perceptron(n_inputs=2, learning_rate=0.1, epochs=5)
errors_history = model.fit(X, y)


# ---------------------------
# 5. –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ—Ü–µ—Å—É –Ω–∞–≤—á–∞–Ω–Ω—è
# ---------------------------
# plt.figure(figsize=(6,4))
# plt.plot(errors_history, marker='o')
# plt.title("–î–∏–Ω–∞–º—ñ–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è –ø–µ—Ä—Ü–µ–ø—Ç—Ä–æ–Ω–∞")
# plt.xlabel("–ï–ø–æ—Ö–∞")
# plt.ylabel("–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫")
# plt.grid(True)
# plt.show()

# ---------------------------
# 6. –ü–æ–±—É–¥–æ–≤–∞ —Ä–æ–∑–¥—ñ–ª—è—é—á–æ—ó –ª—ñ–Ω—ñ—ó
# ---------------------------
def plot_decision_boundary(model, X, y):
    cmap_light = ListedColormap(['#A0FFA0', '#FFAAAA'])
    cmap_bold = ['green', 'red']

    x_min, x_max = X[:, 0].min() - 1, X[:, 0].max() + 1
    y_min, y_max = X[:, 1].min() - 1, X[:, 1].max() + 1
    xx, yy = np.meshgrid(np.arange(x_min, x_max, 0.02),
                         np.arange(y_min, y_max, 0.02))

    Z = model.predict(np.c_[xx.ravel(), yy.ravel()])
    Z = Z.reshape(xx.shape)

    plt.figure(figsize=(7, 5))
    plt.contourf(xx, yy, Z, cmap=cmap_light, alpha=0.6)
    plt.scatter(X[:, 0], X[:, 1], c=y, cmap=ListedColormap(cmap_bold), edgecolor='k')
    plt.title("–†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ –ø–µ—Ä—Ü–µ–ø—Ç—Ä–æ–Ω–æ–º")
    plt.xlabel("–í–∞–≥–∞ (–Ω–æ—Ä–º.)")
    plt.ylabel("–ö–æ–ª—ñ—Ä (–Ω–æ—Ä–º.)")
    # plt.show()


# plot_decision_boundary(model, X, y)

# ---------------------------
# 7. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
# ---------------------------
new_samples = np.array([
    [0.1, 0.1],  # –ª–µ–≥–∫–∞ —ñ —Å–≤—ñ—Ç–ª–∞ -> –≥—Ä—É—à–∞
    [1.0, 0.8],  # –≤–∞–∂–∫–∞ —ñ —Ç–µ–º–Ω–∞ -> —è–±–ª—É–∫–æ
    [0.3, 0.6],  # –ø—Ä–æ–º—ñ–∂–Ω–µ
])

predictions = model.predict(new_samples)
for i, p in enumerate(predictions):
    print(p)
    label = "–Ø–±–ª—É–∫–æ üçé" if p == 1 else "–ì—Ä—É—à–∞ üçê"
    print(f"–ó—Ä–∞–∑–æ–∫ {i + 1}: {new_samples[i]} -> {label}")

# –û—Ü—ñ–Ω–∫–∞ –º–æ–¥–µ–ª—ñ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
evaluate_model(model, X, y)

# –í–≥–∞–¥—É—î–º–æ —è–±–ª—É–∫–æ
# TP - True Positive - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≥–∞–¥–∞–ª–∏ —è–±–ª—É–∫–æ
# TN - True Negative - –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–≥–∞–¥–∞–ª–∏ –≥—Ä—É—à—É
# FP - False Positive - –ø–æ–º–∏–ª–∫–æ–≤–æ –≤–≥–∞–¥–∞–ª–∏ —è–±–ª—É–∫–æ (–Ω–∞—Å–ø—Ä–∞–≤–¥—ñ –≥—Ä—É—à–∞)
# FN - False Negative - –ø–æ–º–∏–ª–∫–æ–≤–æ –≤–≥–∞–¥–∞–ª–∏ –≥—Ä—É—à

# Accuracy = (TP + TN) / (TP + TN + FP + FN) - —Ç–æ—á–Ω—ñ—Å—Ç—å - —Å–∫—ñ–ª—å–∫–∏ –≤—Å—å–æ–≥–æ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω—å –±—É–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏

# Precision = TP / (TP + FP) - —Ç–æ—á–Ω—ñ—Å—Ç—å / –≤–ª—É—á–Ω—ñ—Å—Ç—å - —Å–∫—ñ–ª—å–∫–∏ –∑ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏—Ö —è–±–ª—É–∫ –±—É–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏
# Recall = TP / (TP + FN) - –ø–æ–≤–Ω–æ—Ç–∞ - —Å–∫—ñ–ª—å–∫–∏ –∑ —É—Å—ñ—Ö —è–±–ª—É–∫ –º–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–±–∞—á–∏–ª–∏ - —á—É—Ç–ª–∏–≤—ñ—Å—Ç—å

# F1-Score = 2 * (Precision * Recall) / (Precision + Recall) - –≥–∞—Ä–º–æ–Ω—ñ–π–Ω–µ —Å–µ—Ä–µ–¥–Ω—î –º—ñ–∂ precision —ñ recall
# f1 - —á–∏–º –≤–∏—â–µ, —Ç–∏–º –∫—Ä–∞—â–µ –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å –º—ñ–∂ precision —ñ recall, —ñ —Ç–∏–º –∫—Ä–∞—â–∞ –º–æ–¥–µ–ª—å –∑–∞–≥–∞–ª–æ–º. –Ü –¥–µ 1 - —ñ–¥–µ–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å
# –ó–∞–¥–æ–≤—ñ–ª—å–Ω–∏–π –¥—ñ–∞–ø–∞–∑–æ–Ω –¥–ª—è f1 - –≤—ñ–¥ 0.7 —ñ –≤–∏—â–µ - —Ö–æ—Ä–æ—à–∞ –º–æ–¥–µ–ª—å

# MSE, MAE, R¬≤ - –¥–ª—è —Ä–µ–≥—Ä–µ—Å—ñ—ó
# MSE - —Å–µ—Ä–µ–¥–Ω—å–æ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ - —Å–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –∫–≤–∞–¥—Ä–∞—Ç—ñ–≤ –ø–æ–º–∏–ª–æ–∫ –º—ñ–∂ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏–º–∏ —ñ —Ñ–∞–∫—Ç–∏—á–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏
# MAE - —Å–µ—Ä–µ–¥–Ω—è –∞–±—Å–æ–ª—é—Ç–Ω–∞ –ø–æ–º–∏–ª–∫–∞ - —Å–µ—Ä–µ–¥–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è –∞–±—Å–æ–ª—é—Ç–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ –º—ñ–∂ –ø–µ—Ä–µ–¥–±–∞—á–µ–Ω–∏–º–∏ —ñ —Ñ–∞–∫—Ç–∏—á–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏
# R¬≤ - –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –¥–µ—Ç–µ—Ä–º—ñ–Ω–∞—Ü—ñ—ó - –ø–æ–∫–∞–∑—É—î, —è–∫–∞ —á–∞—Å—Ç–∫–∞ –¥–∏—Å–ø–µ—Ä—Å—ñ—ó –∑–∞–ª–µ–∂–Ω–æ—ó –∑–º—ñ–Ω–Ω–æ—ó –ø–æ—è—Å–Ω—é—î—Ç—å—Å—è –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏ –≤ –º–æ–¥–µ–ª—ñ. –í—ñ–¥ -‚àû –¥–æ 1, –¥–µ 1 - —ñ–¥–µ–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å

# ROC-AUC - –¥–ª—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
# ROC - –∫—Ä–∏–≤–∞ —Ä–æ–±–æ—á–æ—ó —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–∏–π–º–∞—á–∞ - –≥—Ä–∞—Ñ—ñ–∫, —â–æ –ø–æ–∫–∞–∑—É—î —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è –º—ñ–∂ —á—É—Ç–ª–∏–≤—ñ—Å—Ç—é (True Positive Rate) —ñ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ—Å—Ç—é (1 - False Positive Rate) –ø—Ä–∏ —Ä—ñ–∑–Ω–∏—Ö –ø–æ—Ä–æ–≥–∞—Ö –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
# AUC - –ø–ª–æ—â–∞ –ø—ñ–¥ ROC-–∫—Ä–∏–≤–æ—é - —á–∏—Å–µ–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è, —â–æ –ø–æ–∫–∞–∑—É—î —è–∫—ñ—Å—Ç—å –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ–π–Ω–æ—ó –º–æ–¥–µ–ª—ñ. –í—ñ–¥ 0 –¥–æ 1, –¥–µ 1 - —ñ–¥–µ–∞–ª—å–Ω–∞ –º–æ–¥–µ–ª—å

# ===============================================